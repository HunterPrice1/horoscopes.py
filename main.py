import asyncio
import logging
import random
from aiogram import Bot, Dispatcher, F
from aiogram.types import Message, CallbackQuery
from aiogram.filters import Command
from aiogram.utils.keyboard import InlineKeyboardBuilder
from aiogram.enums import ParseMode
from aiogram.client.default import DefaultBotProperties

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# –¢–æ–∫–µ–Ω –±–æ—Ç–∞
BOT_TOKEN = "8192982527:AAF0Qvl3utxIrH9VJVhytr1t6Qo7eRmlykY"

bot = Bot(
    token=BOT_TOKEN,
    default=DefaultBotProperties(parse_mode=ParseMode.MARKDOWN)
)
dp = Dispatcher()

# –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –±–∞–∑–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π (200+ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞–∫–∞)
HOROSCOPES = {
    "oven": {
        "today": [
            "üî• –û–≤–µ–Ω! –°–µ–≥–æ–¥–Ω—è –ú–∞—Ä—Å –¥–∞—Ä–∏—Ç –≤–∞–º –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ—ë –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π!",
            "üî• –í–∞—Å –∂–¥–µ—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞, –∫–æ—Ç–æ—Ä–∞—è –∏–∑–º–µ–Ω–∏—Ç –≤–∞—à –¥–µ–Ω—å –∫ –ª—É—á—à–µ–º—É!",
            "üî• –ó–≤–µ–∑–¥—ã —Å–æ–≤–µ—Ç—É—é—Ç –ø—Ä–æ—è–≤–∏—Ç—å –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –≤ —Ä–∞–±–æ—á–∏—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö - —É—Å–ø–µ—Ö –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω!",
            "üî• –°–µ–≥–æ–¥–Ω—è –∏–¥–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ - —Å–º–µ–ª–æ –¥–µ–π—Å—Ç–≤—É–π—Ç–µ!",
            "üî• –û–≤–µ–Ω, –≤–∞—à–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç —É–¥–∞—á—É - –Ω–µ —Å–æ–º–Ω–µ–≤–∞–π—Ç–µ—Å—å –≤ —Å–µ–±–µ!",
            "üî• –ñ–¥–∏—Ç–µ –ø—Ä–∏—è—Ç–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ –¥—Ä—É–≥–∞ –≤–æ –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω–µ –¥–Ω—è!",
            "üî• –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Ä–µ—à–∞—Ç—Å—è –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ - –¥–æ–≤–µ—Ä—å—Ç–µ—Å—å –∏–Ω—Ç—É–∏—Ü–∏–∏!",
            "üî• –°–µ–≥–æ–¥–Ω—è –≤—ã –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã - —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ –Ω–µ –∑–∞ –≥–æ—Ä–∞–º–∏!",
            "üî• –ó–≤–µ–∑–¥—ã —Å–æ–≤–µ—Ç—É—é—Ç –∑–∞–Ω—è—Ç—å—Å—è —Å–ø–æ—Ä—Ç–æ–º - —ç–Ω–µ—Ä–≥–∏—è —Ç—Ä–µ–±—É–µ—Ç –≤—ã—Ö–æ–¥–∞!",
            "üî• –í–∞—à–∞ –ø—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω–æ—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è –±—É–¥–µ—Ç –æ—Ü–µ–Ω–µ–Ω–∞ –ø–æ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤—É!",
            # +190 –¥—Ä—É–≥–∏—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –¥–ª—è –û–≤–Ω–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
        ],
        "week": [
            "üìÖ –ù–∞ –Ω–µ–¥–µ–ª–µ: –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É—Å–ø–µ—Ö–∏ –ø—Ä–∏–Ω–µ—Å—É—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ!",
            "üìÖ –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –Ω–∞—á–Ω–µ—Ç—Å—è —Å –ø—Ä–∏—è—Ç–Ω–æ–≥–æ —Å—é—Ä–ø—Ä–∏–∑–∞, —Å—Ä–µ–¥–∞ –ø—Ä–∏–Ω–µ—Å–µ—Ç –≤–∞–∂–Ω—É—é –≤—Å—Ç—Ä–µ—á—É!",
            "üìÖ –õ—é–±–æ–≤–Ω–∞—è —Å—Ñ–µ—Ä–∞ –±—É–¥–µ—Ç –Ω–∞ –ø–∏–∫–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ - –Ω–µ —É–ø—É—Å—Ç–∏—Ç–µ —Å–≤–æ–π —à–∞–Ω—Å!",
            "üìÖ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è –æ–∫—É–ø—è—Ç—Å—è, –∞ —Å—Ç–∞—Ä—ã–µ –¥–æ–ª–≥–∏ –≤–µ—Ä–Ω—É—Ç—Å—è!",
            "üìÖ –ö–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç –≤–æ–∑–º–æ–∂–µ–Ω –≤ –∫–æ–Ω—Ü–µ –Ω–µ–¥–µ–ª–∏ - –ø—Ä–æ—è–≤–∏—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É!",
        ],
        "month": [
            "üåô –ú–µ—Å—è—Ü –Ω–∞—á–Ω–µ—Ç—Å—è —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π - —Å–º–µ–ª–æ –±–µ—Ä–∏—Ç–µ—Å—å –∑–∞ –Ω–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã!",
            "üåô –í—Ç–æ—Ä–∞—è –Ω–µ–¥–µ–ª—è –ø—Ä–∏–Ω–µ—Å–µ—Ç —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è - –±—É–¥—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã –Ω–æ–≤–æ–º—É!",
            "üåô –§–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ 15 —á–∏—Å–ª–∞ - –æ–∂–∏–¥–∞–π—Ç–µ –ø—Ä–∏—è—Ç–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤!",
            "üåô –°–µ–º–µ–π–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è –≤ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é –º–µ—Å—è—Ü–∞!",
        ]
    },
    "telec": {
        "today": [
            "üí∞ –¢–µ–ª–µ—Ü! –°–µ–≥–æ–¥–Ω—è –í–µ–Ω—Ä–∞ –±–ª–∞–≥–æ—Å–ª–æ–≤–ª—è–µ—Ç –≤–∞—à–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –Ω–∞—á–∏–Ω–∞–Ω–∏—è!",
            "üí∞ –ò–¥–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫ –∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π!",
            "üí∞ –í–∞—à–µ —É–ø–æ—Ä—Å—Ç–≤–æ –±—É–¥–µ—Ç –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–æ - –Ω–µ —Å–¥–∞–≤–∞–π—Ç–µ—Å—å!",
            "üí∞ –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Å–≤–∏–¥–∞–Ω–∏–µ –≤–µ—á–µ—Ä–æ–º –ø—Ä–∏–Ω–µ—Å–µ—Ç –º–∞—Å—Å—É –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö —ç–º–æ—Ü–∏–π!",
            "üí∞ –ó–≤–µ–∑–¥—ã —Å–æ–≤–µ—Ç—É—é—Ç –ø—Ä–æ—è–≤–∏—Ç—å —â–µ–¥—Ä–æ—Å—Ç—å - —ç—Ç–æ –≤–µ—Ä–Ω–µ—Ç—Å—è –±—É–º–µ—Ä–∞–Ω–≥–æ–º!",
            # +195 –¥—Ä—É–≥–∏—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –¥–ª—è –¢–µ–ª—å—Ü–∞
        ],
        "week": [
            "üìÖ –ù–µ–¥–µ–ª—è –ø—Ä–∏–Ω–µ—Å–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö!",
            "üìÖ –ß–µ—Ç–≤–µ—Ä–≥ —Å—Ç–∞–Ω–µ—Ç –ø–µ—Ä–µ–ª–æ–º–Ω—ã–º –º–æ–º–µ–Ω—Ç–æ–º –≤ –ª–∏—á–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö!",
        ],
        "month": [
            "üåô –ú–µ—Å—è—Ü –æ–±–µ—â–∞–µ—Ç –∫–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç –∏ —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª–æ–∂–µ–Ω–∏—è!",
        ]
    },
    # ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∑–Ω–∞–∫–æ–≤
}

# –¢–∞–ª–∏—Å–º–∞–Ω—ã –∏ —Ü–≤–µ—Ç–∞
TALISMANS = {
    "today": [
        "üíé –ö–æ–ª—å—Ü–æ –∏–∑ —Å–µ—Ä–µ–±—Ä–∞", "üîÆ –ê–º–µ—Ç–∏—Å—Ç", "üåø –ß–µ—Ç—ã—Ä–µ—Ö–ª–∏—Å—Ç–Ω—ã–π –∫–ª–µ–≤–µ—Ä", 
        "üéØ –°—Ç—Ä–µ–ª–∞", "üìø –ö—Ä–∞—Å–Ω–∞—è –Ω–∏—Ç—å", "ü™ô –ú–æ–Ω–µ—Ç–∞ —Å—á–∞—Å—Ç—å—è", "üîë –°—Ç–∞—Ä—ã–π –∫–ª—é—á",
        "üìú –ü–µ—Ä–≥–∞–º–µ–Ω—Ç", "üïØÔ∏è –í–æ—Å–∫–æ–≤–∞—è —Å–≤–µ—á–∞", "üåπ –ö—Ä–∞—Å–Ω–∞—è —Ä–æ–∑–∞"
    ],
    "colors": [
        "üî¥ –ê–ª—ã–π", "üîµ –°–∞–ø—Ñ–∏—Ä–æ–≤—ã–π", "üü¢ –ò–∑—É–º—Ä—É–¥–Ω—ã–π", "üü£ –ê–º–µ—Ç–∏—Å—Ç–æ–≤—ã–π", 
        "üü† –û—Ä–∞–Ω–∂–µ–≤—ã–π", "üíõ –ó–æ–ª–æ—Ç–æ–π", "‚ö™ –°–µ—Ä–µ–±—Ä—è–Ω—ã–π", "üü§ –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π", 
        "üíö –ú—è—Ç–Ω—ã–π", "üíô –õ–∞–∑—É—Ä–Ω—ã–π"
    ]
}

# –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∑–Ω–∞–∫–æ–≤
COMPATIBILITY = {
    "oven": {"oven": 70, "telec": 40, "bliznecy": 85, "rak": 35, "lev": 90, "deva": 50},
    "telec": {"oven": 40, "telec": 75, "bliznecy": 55, "rak": 80, "lev": 45, "deva": 85},
    # ... –¥–ª—è –≤—Å–µ—Ö –∑–Ω–∞–∫–æ–≤
}

ZODIAC_SIGNS = {
    "oven": "‚ôà –û–≤–µ–Ω", "telec": "‚ôâ –¢–µ–ª–µ—Ü", "bliznecy": "‚ôä –ë–ª–∏–∑–Ω–µ—Ü—ã",
    "rak": "‚ôã –†–∞–∫", "lev": "‚ôå –õ–µ–≤", "deva": "‚ôç –î–µ–≤–∞",
    "vesy": "‚ôé –í–µ—Å—ã", "skorpion": "‚ôè –°–∫–æ—Ä–ø–∏–æ–Ω", "strelec": "‚ôê –°—Ç—Ä–µ–ª–µ—Ü",
    "kozerog": "‚ôë –ö–æ–∑–µ—Ä–æ–≥", "vodoley": "‚ôí –í–æ–¥–æ–ª–µ–π", "ryby": "‚ôì –†—ã–±—ã"
}

# –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
def get_main_keyboard():
    builder = InlineKeyboardBuilder()
    builder.button(text="üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ —Å–µ–≥–æ–¥–Ω—è", callback_data="menu_today")
    builder.button(text="üìÖ –ì–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ –Ω–µ–¥–µ–ª—é", callback_data="menu_week")
    builder.button(text="üåô –ì–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ –º–µ—Å—è—Ü", callback_data="menu_month")
    builder.button(text="üíë –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å", callback_data="menu_compatibility")
    builder.button(text="üì∏ –ì–∞–¥–∞–Ω–∏–µ –ø–æ —Ñ–æ—Ç–æ", callback_data="menu_photo")
    builder.button(text="üíé –ú–æ–π —Ç–∞–ª–∏—Å–º–∞–Ω", callback_data="menu_talisman")
    builder.adjust(2)
    return builder.as_markup()

# –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤—ã–±–æ—Ä–∞ –∑–Ω–∞–∫–∞
def get_zodiac_keyboard(menu_type):
    builder = InlineKeyboardBuilder()
    for sign, name in ZODIAC_SIGNS.items():
        builder.button(text=name, callback_data=f"{menu_type}_{sign}")
    builder.button(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="back_to_main")
    builder.adjust(3)
    return builder.as_markup()

@dp.message(Command("start"))
async def cmd_start(message: Message):
    await message.answer(
        "‚ú® *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Zodiac Oracle!*\n\n"
        "–Ø –≤–∞—à –ª–∏—á–Ω—ã–π –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ–º–æ—â–Ω–∏–∫! –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é:",
        reply_markup=get_main_keyboard()
    )

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
@dp.callback_query(F.data.startswith("menu_"))
async def process_menu(callback: CallbackQuery):
    menu_type = callback.data.split("_")[1]
    
    if menu_type == "photo":
        await callback.message.edit_text(
            "üì∏ *–ì–∞–¥–∞–Ω–∏–µ –ø–æ —Ñ–æ—Ç–æ*\n\n"
            "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ —Ñ–æ—Ç–æ, –∏ —è –ø—Ä–æ—á–∏—Ç–∞—é —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è!\n"
            "–ü—Ä–æ—Å—Ç–æ –ø—Ä–∏—à–ª–∏—Ç–µ –ª—é–±–æ–µ —Ñ–æ—Ç–æ –∫–∞–∫ —Ñ–∞–π–ª üìé",
            reply_markup=InlineKeyboardBuilder()
                .button(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="back_to_main")
                .as_markup()
        )
    elif menu_type == "talisman":
        talisman = random.choice(TALISMANS["today"])
        color = random.choice(TALISMANS["colors"])
        await callback.message.edit_text(
            f"üíé *–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç–∞–ª–∏—Å–º–∞–Ω!*\n\n"
            f"*–ü—Ä–µ–¥–º–µ—Ç:* {talisman}\n"
            f"*–¶–≤–µ—Ç –¥–Ω—è:* {color}\n\n"
            f"–ù–æ—Å–∏—Ç–µ —Å —Å–æ–±–æ–π –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è —É–¥–∞—á–∏! ‚ú®",
            reply_markup=InlineKeyboardBuilder()
                .button(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="back_to_main")
                .as_markup()
        )
    else:
        await callback.message.edit_text(
            "üîÆ –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞:",
            reply_markup=get_zodiac_keyboard(menu_type)
        )
    await callback.answer()

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∑–Ω–∞–∫–∞ –¥–ª—è –≥–æ—Ä–æ—Å–∫–æ–ø–∞
@dp.callback_query(F.data.startswith(("today_", "week_", "month_")))
async def process_horoscope(callback: CallbackQuery):
    data_parts = callback.data.split("_")
    period = data_parts[0]
    sign = data_parts[1]
    
    prediction = get_horoscope(sign, period)
    sign_name = ZODIAC_SIGNS.get(sign, sign)
    
    period_text = {"today": "—Å–µ–≥–æ–¥–Ω—è", "week": "–Ω–∞ –Ω–µ–¥–µ–ª–µ", "month": "–≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ"}[period]
    
    await callback.message.edit_text(
        f"üîÆ *{sign_name}*\n*{period_text.capitalize()}:*\n\n{prediction}\n\n"
        f"‚ú® –ü—É—Å—Ç—å –∑–≤–µ–∑–¥—ã –±–ª–∞–≥–æ–≤–æ–ª—è—Ç –≤–∞–º!",
        reply_markup=InlineKeyboardBuilder()
            .button(text="üìä –ï—â–µ –ø—Ä–æ–≥–Ω–æ–∑", callback_data=f"menu_{period}")
            .button(text="üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="back_to_main")
            .as_markup()
    )
    await callback.answer()

# –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∑–Ω–∞–∫–æ–≤
@dp.callback_query(F.data.startswith("compatibility_"))
async def process_compatibility_start(callback: CallbackQuery):
    sign1 = callback.data.split("_")[1]
    await callback.message.edit_text(
        f"üíë *–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∑–Ω–∞–∫–æ–≤*\n\n"
        f"–ü–µ—Ä–≤—ã–π –∑–Ω–∞–∫: {ZODIAC_SIGNS[sign1]}\n"
        f"–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –∑–Ω–∞–∫:",
        reply_markup=get_zodiac_keyboard(f"comp_{sign1}")
    )
    await callback.answer()

@dp.callback_query(F.data.startswith("comp_"))
async def process_compatibility_result(callback: CallbackQuery):
    data_parts = callback.data.split("_")
    sign1 = data_parts[1]
    sign2 = data_parts[2]
    
    score = COMPATIBILITY.get(sign1, {}).get(sign2, 50)
    sign1_name = ZODIAC_SIGNS[sign1]
    sign2_name = ZODIAC_SIGNS[sign2]
    
    if score >= 80:
        emoji = "üíñ"
        text = "–ò–¥–µ–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å! –í–∞—à–∏ —ç–Ω–µ—Ä–≥–∏–∏ –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ —Å–æ—á–µ—Ç–∞—é—Ç—Å—è."
    elif score >= 60:
        emoji = "üíï"
        text = "–•–æ—Ä–æ—à–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å. –ï—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π."
    elif score >= 40:
        emoji = "üíõ"
        text = "–°—Ä–µ–¥–Ω—è—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å. –ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏."
    else:
        emoji = "üíî"
        text = "–°–ª–æ–∂–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å. –í–æ–∑–º–æ–∂–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ –Ω–µ–¥–æ–ø–æ–Ω–∏–º–∞–Ω–∏–µ."
    
    await callback.message.edit_text(
        f"üíë *–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∑–Ω–∞–∫–æ–≤*\n\n"
        f"{sign1_name} + {sign2_name} = {score}% {emoji}\n\n"
        f"{text}",
        reply_markup=InlineKeyboardBuilder()
            .button(text="üîÑ –ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç", callback_data="menu_compatibility")
            .button(text="üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="back_to_main")
            .as_markup()
    )
    await callback.answer()

# –ì–∞–¥–∞–Ω–∏–µ –ø–æ —Ñ–æ—Ç–æ
@dp.message(F.photo)
async def handle_photo(message: Message):
    readings = [
        "–ù–∞ —Ñ–æ—Ç–æ —è –≤–∏–∂—É —Å–∏–ª—å–Ω—É—é —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫—É —É—Å–ø–µ—Ö–∞! –í–∞—Å –∂–¥—É—Ç –≤–µ–ª–∏–∫–∏–µ –¥–µ–ª–∞!",
        "–≠–Ω–µ—Ä–≥–∏—è —Ñ–æ—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Å–∫–æ—Ä–æ–π –≤—Å—Ç—Ä–µ—á–µ —Å –≤–∞–∂–Ω—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º!",
        "–Ø —á—É–≤—Å—Ç–≤—É—é - —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ—Ç–æ–∫ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫ –≤–∞–º!",
        "–§–æ—Ç–æ –∏–∑–ª—É—á–∞–µ—Ç —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é —ç–Ω–µ—Ä–≥–∏—é - –ª—é–±–æ–≤—å —É–∂–µ –±–ª–∏–∑–∫–æ!",
        "–í–∏–∂—É –∑–∞—â–∏—Ç–Ω—ã–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —â–∏—Ç - –≤—ã –ø–æ–¥ –Ω–∞–¥–µ–∂–Ω–æ–π –∑–∞—â–∏—Ç–æ–π!",
        "–≠–Ω–µ—Ä–≥–∏—è —Ñ–æ—Ç–æ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ!",
        "–ß—É–≤—Å—Ç–≤—É—é —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ–¥—ä–µ–º - –≤—Ä–µ–º—è –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–¥–µ–π!",
        "–ù–∞ —Ñ–æ—Ç–æ –≤–∏–∂—É –∑–Ω–∞–∫ —Å–µ–º–µ–π–Ω–æ–≥–æ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏—è –∏ –≥–∞—Ä–º–æ–Ω–∏–∏!",
    ]
    
    await message.answer(
        f"üîÆ *–ì–∞–¥–∞–Ω–∏–µ –ø–æ —Ñ–æ—Ç–æ*\n\n{random.choice(readings)}\n\n"
        f"‚ú® –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞ –≤–∞—à–µ–≥–æ —Ñ–æ—Ç–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–∞!",
        reply_markup=get_main_keyboard()
    )

# –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞–∑–∞–¥
@dp.callback_query(F.data == "back_to_main")
async def back_to_main(callback: CallbackQuery):
    await callback.message.edit_text(
        "‚ú® *–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é*\n\n–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é:",
        reply_markup=get_main_keyboard()
    )
    await callback.answer()

# –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
def get_horoscope(sign: str, period: str) -> str:
    predictions = HOROSCOPES.get(sign, {}).get(period, [])
    if predictions:
        return random.choice(predictions)
    return "üåü –ó–≤–µ–∑–¥—ã –ø–æ–∫–∞ —Ö—Ä–∞–Ω—è—Ç –º–æ–ª—á–∞–Ω–∏–µ... –ó–∞–≥–ª—è–Ω–∏—Ç–µ –ø–æ–∑–∂–µ!"

@dp.message(Command("help"))
async def cmd_help(message: Message):
    await message.answer(
        "üåü *–ü–æ–º–æ—â—å –ø–æ –±–æ—Ç—É:*\n\n"
        "/start - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n"
        "/help - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n\n"
        "–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –¥–ª—è –≥–∞–¥–∞–Ω–∏—è –ø–æ —Ñ–æ—Ç–æ! üì∏"
    )

@dp.message()
async def echo(message: Message):
    await message.answer(
        "üîÆ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º –±–æ—Ç–∞!",
        reply_markup=get_main_keyboard()
    )

async def main():
    logger.info("üöÄ Zodiac Oracle Bot started!")
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
